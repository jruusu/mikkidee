<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <script src="//code.jquery.com/jquery-2.0.3.min.js"></script>

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
    <![endif]-->
    <script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>

  </head>

  <body style="border: 0px">
    <div id="map" style="width: 100%; height: 800px"></div>

    <script>
      var map = L.map('map').setView([60.170827, 24.940218], 12);

      L.tileLayer('http://{s}.tile.cloudmade.com/{key}/22677/256/{z}/{x}/{y}.png', {
        attribution: 'Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2012 CloudMade',
        key: 'BC9A493B41014CAABB98F0471D759707'
      }).addTo(map);

      $.ajax({
        dataType: "json",
        url: '/data',
        async: false
      }).then(
        function(data, status, xhr) {
          L.geoJson([data], {
            style: function (feature) {
              return feature.properties && feature.properties.style;
            },
            onEachFeature: function(feature, layer) {
              layer.bindPopup(feature.properties.address);
            },
            pointToLayer: function (feature, latlng) {
              return L.circleMarker(latlng, {
                radius: 8,
                fillColor: "#ff7800",
                color: "#000",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.8
              });
            }
          }).addTo(map);
        },
        function() {}
      );
    </script>
  </body>

</html>
