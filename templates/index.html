<!DOCTYPE html>
<html style="min-height: 100%; height: 100%">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <script src="//code.jquery.com/jquery-2.0.3.min.js"></script>

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
    <![endif]-->
    <script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>

    <style>
      html, body {
        height: 100%;
        min-height: 100%;
        margin: 0px;
        padding: 0px;
      }
      #map {
        width: 100%;
        height: 100%;
        min-height: 800px;
      }
    </style>

  </head>

  <body>
    <div id="map"></div>

    <script>
      var map = L.map('map').setView([60.170827, 24.940218], 12);

      var osm = L.tileLayer('http://{s}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png', {
	minZoom: 13,
	maxZoom: 16,
	attribution: '&copy; <a href="http://www.opencyclemap.org">OpenCycleMap</a>, &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'
      });

      osm.addTo(map);

      var stamen = L.tileLayer('http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg', {
	attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
	subdomains: 'abcd',
	minZoom: 3,
	maxZoom: 12
      });

      stamen.addTo(map);

      $.ajax({
        dataType: "json",
        url: '/data',
        async: false
      }).then(
        function(data, status, xhr) {
          L.geoJson([data], {
            style: function (feature) {
              return feature.properties && feature.properties.style;
            },
            onEachFeature: function(feature, layer) {
              layer.bindPopup(feature.properties.address);
            },
            pointToLayer: function (feature, latlng) {
              return L.circleMarker(latlng, {
                radius: 8,
                fillColor: "#ff7800",
                color: "#000",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.8
              });
            }
          }).addTo(map);
        },
        function() {}
      );
    </script>
  </body>

</html>
